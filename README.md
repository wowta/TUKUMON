# iPhone 12 規格 画像重ね合わせ Webアプリ

Pygame を使用した、iPhone 12 論理解像度（390 x 844px）の画像重ね合わせアプリケーションです。

## 概要

`img` フォルダ内の全ての画像を読み込み、画面中央に重ねて表示します。起動時に動的にフォルダをスキャンし、対応形式の画像を自動で読み込みます。

### 機能

- **動的画像読み込み**: 起動時に `img` フォルダ内のファイルをスキャン
- **アスペクト比保持**: 全ての画像をアスペクト比を保ったままリサイズ
- **画面中央配置**: スケール済み画像を画面の真ん中に配置
- **エラーハンドリング**: 読み込み失敗やフォルダ欠落時の例外処理を実装
- **Web対応**: `pygbag` でブラウザ実行可能な構造

## フォルダ構成

```
TUKUMON/
├── main.py              # メインプログラム
├── README.md            # このファイル
├── img/                 # 画像フォルダ（重ね合わせする画像を配置）
│   ├── image1.png
│   ├── image2.jpg
│   └── ...
└── .git/                # Git リポジトリ
```

### img フォルダの配置

- **場所**: プロジェクトルート（`main.py` と同じディレクトリ）に `img` フォルダを配置します
- **対応形式**: `*.png`, `*.jpg`, `*.jpeg`, `*.bmp`, `*.gif`
- **画像の順序**: ファイル名でソートされた順に重ねられます

## 環境構築

### 1. Python のインストール確認

Python 3.6 以上がインストールされていることを確認します。

```bash
python3 --version
```

### 2. 依存パッケージのインストール

```bash
pip install pygame pygbag
```

- **pygame**: ローカル実行用の画像処理・ウィンドウ管理ライブラリ
- **pygbag**: Pygame のプログラムをブラウザで実行するツール

## 使用方法

### ローカルでの実行（デスクトップ）

```bash
python3 main.py
```

ウィンドウが立ち上がり、`img` フォルダ内の全画像が中央に重ねて表示されます。

- **終了**: ウィンドウのクローズボタンをクリックするか、`ESC` キーを押します

### ブラウザでの実行（Web化）

```bash
pygbag .
```

このコマンドでローカル Webサーバーが起動し、デフォルトブラウザで自動的にアプリが開きます。

- **アクセス URL**: `http://localhost:8000`
- **ポート**: デフォルトは 8000（競合時は自動的に調整）
- **終了**: ターミナルで `Ctrl+C` を入力

### スマートフォンからの動作確認（同じWiFi環境）

同じWiFi ネットワークに接続したスマートフォンから動作確認できます。

#### 1. ローカルマシンの IP アドレスを確認

```bash
# macOS の場合
ipconfig getifaddr en0

# Linux/Windows の場合
hostname -I
```

出力例: `10.20.218.164`

#### 2. pygbag でサーバーを起動

デスクトップマシンでプロジェクトフォルダに移動し、以下を実行：

```bash
pygbag .
```

サーバーが起動すると、ターミナルに以下のようなメッセージが表示されます：

```
Listening on http://0.0.0.0:8000
```

#### 3. スマートフォンでアクセス

スマートフォンのブラウザ（Chrome、Safari など）のアドレスバーに以下を入力：

```
http://10.20.218.164:8000
```

**注意**: IP アドレスはマシンの設定に応じて異なります。上記の例では `10.20.218.164` ですが、実際のアドレスに置き換えてください。

#### トラブルシューティング

**スマートフォンからアクセスできない場合**:

1. **WiFi 接続の確認**: スマートフォンとマシンが同じWiFi ネットワークに接続されていることを確認
2. **ファイアウォールの確認**: macOS のファイアウォール設定で、Python がネットワークアクセスを許可されているか確認
   - **System Preferences** → **Security & Privacy** → **Firewall Options** → **Python を許可** 
3. **IP アドレスの確認**: スマートフォンとマシンが同じサブネット（192.168.x.x など）にいることを確認
4. **別のポート試行**: ポート 8000 が競合している場合、以下で別のポートで起動：
   ```bash
   pygbag --port 8080 .
   ```
   その場合、スマートフォンから `http://10.20.218.164:8080` でアクセス

## 技術仕様

### 画面サイズ

- **解像度**: 390 x 844 ピクセル（iPhone 12 論理解像度）
- **背景色**: #F0F0F0（淡いグレー）

### 画像スケーリング

- **保持**: アスペクト比を維持したまま画面にフィット
- **方式**: 幅または高さの制約に基づき、より小さいスケール値を採用
- **配置**: 全ての画像を画面中央（Center）に配置

### 非同期処理

- **フレームワーク**: `asyncio` を使用
- **メインループ**: `async def main():` 内で実装
- **フレーム待機**: 各ループの最後に `await asyncio.sleep(0)` を挿入
- このため、`pygbag` でのブラウザ実行が可能

### エラーハンドリング

以下の状況でアプリは正常に起動し、コンソールに警告またはエラーメッセージを出力します：

- `img` フォルダが存在しない
- 画像ファイルの読み込みに失敗
- ファイルの処理中に予期しないエラーが発生

## トラブルシューティング

### pygame のインストールに失敗する場合

macOS で問題が発生する場合：

```bash
brew install sdl2 sdl2_image sdl2_mixer sdl2_ttf
pip install pygame --no-cache-dir
```

### pygbag の実行に失敗する場合

Python パスが正しいことを確認：

```bash
which python3
which pygbag
```

必要に応じて、明示的に Python モジュールとして実行：

```bash
python3 -m pygbag .
```

### ブラウザが自動的に開かない場合

手動でアドレスバーに以下を入力：

```
http://localhost:8000
```

## 補足

- **開発環境**: Python 3.6+, Pygame 2.0+, pygbag
- **動作確認済み環境**: macOS 12+, Windows 10+, Ubuntu 20.04+
- **ライセンス**: MIT（必要に応じて記載）
